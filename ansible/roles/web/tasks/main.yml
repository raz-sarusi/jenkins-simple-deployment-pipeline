---
- name: Ensure apt cache is updated
  apt:
    update_cache: yes
  when: ansible_os_family == "Debian"

- name: Install Docker
  apt:
    name: docker.io
    state: present
  when: ansible_os_family == "Debian"

- name: Ensure Docker service is running
  service:
    name: docker
    state: started
    enabled: yes

- name: Stop existing container (if exists)
  command: docker stop mynginx
  ignore_errors: yes

- name: Remove existing container (if exists)
  command: docker rm mynginx
  ignore_errors: yes

- name: Pull latest image
  command: docker pull {{ docker_image }}

- name: Run Nginx container
  command: docker run -d --name mynginx -p 80:80 {{ docker_image }}
